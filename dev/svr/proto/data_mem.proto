// File:        data_mem.proto
// Description: ---
// Notes:       ---
// Author:      leoxiang <leoxiang727@qq.com>
// Revision:    2015-06-09 by leoxiang

import "msg_cs.proto";
import "msg_ss.proto";
package data;

////////////////////////////////////////////////////////////
// Session
enum ENSessionState
{
    SESSION_STATE_ON_CLIENT_MSG           = 1;   // 收到客户端消息
    SESSION_STATE_ON_ROOMSVR_MSG          = 2;   // 收到roomsvr消息
    SESSION_STATE_ON_KVDBSVR_SELECT_MSG   = 3;   // 收到private_dbsvrd消息
    SESSION_STATE_ON_KVDBSVR_UPDATE_MSG   = 4;   //
    SESSION_STATE_ON_KVDBSVR_DELETE_MSG   = 5;   //

    SESSION_STATE_WAIT_ROOMSVR_MSG        = 101; // 等待roomsvr超时
    SESSION_STATE_WAIT_KVDBSVR_SELECT_MSG = 102; // 等待private_dbsvrd超时
    SESSION_STATE_WAIT_KVDBSVR_UPDATE_MSG = 103; // 等待private_dbsvrd超时
    SESSION_STATE_WAIT_KVDBSVR_DELETE_MSG = 104; // 等待private_dbsvrd超时

    SESSION_STATE_FINISH                  = 1000; // 会话结束
}

enum ENSessionDBState
{
    SESSION_DB_STATE_SELECT = 1; // 拉取数据
    SESSION_DB_STATE_UPDATE = 2; // 更新数据
}

message Session
{
    optional uint32             sess_id           = 1;                // 会话ID
    optional uint32             sess_type         = 2;                // 会话类型
    optional ENSessionState     sess_state        = 3;                // 会话状态
    optional uint64             player_uid        = 4;                // 玩家id
    optional int32              timer_id          = 5 [default = -1]; // 定时器
    repeated uint64             db_uids           = 7;                // KVDB操作的玩家uid
    repeated bool               db_uid_flags      = 8;                // KVDB玩家的数据标志
    optional ENSessionDBState   db_state          = 9;                // KVDB操作类型
    optional uint32             db_cur_index      = 10;               // KVDB当前操作的玩家数据位置
    optional uint32             db_process_index  = 11;               // KVDB的玩家处理数据的玩家位置
    optional uint32             create_time       = 18;               // 创建时间
    optional uint32             redo_count        = 19;               // 重做次数
    optional msg.CS				cs_msg            = 51;
    optional msg.CS				cs_response       = 52;
    optional msg.SS				ss_msg            = 53;
    optional msg.SS             ss_response       = 54;
    optional msg.SS             ss_inter_response = 55;
    /*repeated KVDBMsg 	        multi_db_msg = 56;*/
}

// vim:ts=4:sw=4:et:ft=proto:
