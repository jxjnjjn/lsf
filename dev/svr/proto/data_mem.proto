// File:        data_mem.proto
// Description: ---
// Notes:       ---
// Author:      leoxiang <leoxiang727@qq.com>
// Revision:    2015-06-09 by leoxiang

import "msg_cs.proto";
import "msg_ss.proto";
package data;

////////////////////////////////////////////////////////////
// Session
enum ENSessionState {
    SESSION_STATE_ON_CLIENT_MSG         = 1;   // get client message
    SESSION_STATE_ON_ROOMSVR_MSG        = 2;   // get roomsvrd message
    SESSION_STATE_ON_DBSVR_QUERY_MSG    = 3;   // get db query message
    SESSION_STATE_ON_DBSVR_UPDATE_MSG   = 4;   // get db update message
    SESSION_STATE_ON_DBSVR_DELETE_MSG   = 5;   // get db delete message
    SESSION_STATE_WAIT_ROOMSVR_MSG      = 101; // wait roomsvr timeout
    SESSION_STATE_WAIT_DBSVR_QUERY_MSG  = 102; // wait dbsvr query timeout
    SESSION_STATE_WAIT_DBSVR_UPDATE_MSG = 103; // wait dbsvr update timeout
    SESSION_STATE_WAIT_DBSVR_DELETE_MSG = 104; // wait dbsvr delete timeout
    SESSION_STATE_FINISH                = 1000; // session end
}

enum ENSessionDBState {
    SESSION_DB_STATE_QUERY  = 1; // query data
    SESSION_DB_STATE_UPDATE = 2; // update data
}

message Session {
    optional uint32             session_id        = 1;
    optional uint32             session_type      = 2;
    optional ENSessionState     session_state     = 3;
    optional uint64             create_time       = 4;
    optional uint64             player_uid        = 5;
    optional int32              timer_id          = 6 [default = -1];
    repeated uint64             db_uids           = 7;
    repeated bool               db_uid_flags      = 8;
    optional ENSessionDBState   db_state          = 9;
    optional uint32             db_cur_index      = 10;
    optional uint32             db_process_index  = 11;
    optional uint32             redo_count        = 19;
    optional msg.CS				cs_msg            = 51;
    optional msg.CS				cs_response       = 52;
    optional msg.SS				ss_msg            = 53;
    optional msg.SS             ss_response       = 54;
    optional msg.SS             ss_inter_response = 55;
    /*repeated KVDBMsg 	        multi_db_msg = 56;*/
}

////////////////////////////////////////////////////////////
// Timer
enum ENTimerType {
    TIMER_TYPE_SESSION_TIMEOUT = 1;
}

message Timer {
    optional uint32      timer_id            = 1;
    optional uint64      timer_milli_seconds = 2;
    optional ENTimerType timer_type          = 3;
    optional bool        is_delete           = 4;
    // info data
    optional uint32      session_id          = 20;
}


// vim:ts=4:sw=4:et:ft=proto:
